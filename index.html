<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>RPS Game of Life</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            margin: 0;
        }

        #ui {
            width: 200px;
            padding: 10px;
            background: #f0f0f0;
            border-right: 1px solid #ccc;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(50, 12px);
            grid-template-rows: repeat(50, 12px);
            gap: 1px;
            margin: 10px;
        }

        .cell {
            width: 12px;
            height: 12px;
            background: white;
            border: 1px solid #eee;
            cursor: pointer;
        }

        .rock {
            background: red;
        }

        .paper {
            background: green;
        }

        .scissors {
            background: blue;
        }
    </style>
</head>

<body>
    <div id="ui">
        <h3>Controls</h3>
        <button id="startBtn">Start</button>
        <button id="stopBtn">Stop</button>
        <button id="resetBtn">Reset</button>
        <button id="randomizeBtn">Randomize</button>
        <br><br>
        <label for="speed">Speed (ms):</label>
        <input type="number" id="speed" value="500" min="100" step="100">
        <br><br>
        <div>
            <strong>Color:</strong><br>
            <label><input type="radio" name="color" value="rock" checked> Rock</label><br>
            <label><input type="radio" name="color" value="paper"> Paper</label><br>
            <label><input type="radio" name="color" value="scissors"> Scissors</label><br>
            <label><input type="radio" name="color" value="random"> Random</label><br>
            <label><input type="radio" name="color" value="0"> Eraser</label>
        </div>
        <br>
        <div>
            <strong>Tool:</strong><br>
            <label><input type="radio" name="tool" value="1x1" checked> 1x1</label><br>
            <label><input type="radio" name="tool" value="glider-nw"> Glider NW</label><br>
            <label><input type="radio" name="tool" value="glider-ne"> Glider NE</label><br>
            <label><input type="radio" name="tool" value="glider-sw"> Glider SW</label><br>
            <label><input type="radio" name="tool" value="glider-se"> Glider SE</label><br>
            <label><input type="radio" name="tool" value="glider-random"> Glider Random</label>
        </div>
    </div>

    <div id="grid"></div>

    <script>
        const width = 50, height = 50;
        let grid = [];
        let running = false;
        let interval;

        const gridContainer = document.getElementById('grid');

        function createGrid() {
            grid = Array.from({ length: height }, () => Array(width).fill(0));
            gridContainer.innerHTML = '';
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    cell.addEventListener('click', () => toggleCell(x, y));
                    gridContainer.appendChild(cell);
                }
            }
            drawGrid();
        }

        function getSelectedColor() {
            return document.querySelector('input[name="color"]:checked').value;
        }

        function getSelectedTool() {
            return document.querySelector('input[name="tool"]:checked').value;
        }

        const gliderPatterns = {
            'glider-nw': [[0, 1], [1, 2], [2, 0], [2, 1], [2, 2]],
            'glider-ne': [[0, 1], [1, 0], [2, 1], [2, 2], [2, 0]],
            'glider-sw': [[0, 0], [0, 2], [1, 1], [1, 2], [2, 1]],
            'glider-se': [[0, 1], [0, 2], [1, 0], [1, 2], [2, 2]]
        };

        function toggleCell(x, y) {
            const color = getSelectedColor();
            const tool = getSelectedTool();

            const applyState = (nx, ny) => {
                if (ny < height && nx < width) {
                    if (color === 'random') {
                        const options = ['rock', 'paper', 'scissors'];
                        grid[ny][nx] = options[Math.floor(Math.random() * options.length)];
                    } else {
                        grid[ny][nx] = color === '0' ? 0 : color;
                    }
                }
            };

            if (tool === '1x1') {
                applyState(x, y);
            } else if (tool.startsWith('glider')) {
                let pattern;
                if (tool === 'glider-random') {
                    const keys = Object.keys(gliderPatterns);
                    pattern = gliderPatterns[keys[Math.floor(Math.random() * keys.length)]];
                } else {
                    pattern = gliderPatterns[tool];
                }
                for (const [dy, dx] of pattern) {
                    applyState(x + dx, y + dy);
                }
            }

            drawGrid();
        }

        function drawGrid() {
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const idx = y * width + x;
                    const cell = gridContainer.children[idx];
                    cell.className = 'cell';
                    if (grid[y][x]) cell.classList.add(grid[y][x]);
                }
            }
        }

        function getNeighbors(x, y) {
            const deltas = [-1, 0, 1];
            const neighbors = [];
            for (let dx of deltas) {
                for (let dy of deltas) {
                    if (dx === 0 && dy === 0) continue;
                    const nx = x + dx, ny = y + dy;
                    if (nx >= 0 && ny >= 0 && nx < width && ny < height) {
                        neighbors.push(grid[ny][nx]);
                    }
                }
            }
            return neighbors;
        }

        function rpsWinner(a, b) {
            if (a === b) return null;
            const beats = { rock: 'scissors', paper: 'rock', scissors: 'paper' };
            return beats[a] === b ? a : b;
        }

        function step() {
            const newGrid = grid.map(arr => [...arr]);

            // Phase 1: RPS Conflict
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const state = grid[y][x];
                    if (!state) continue;
                    const neighbors = getNeighbors(x, y).filter(n => n);
                    const counts = { rock: 0, paper: 0, scissors: 0 };
                    for (const n of neighbors) counts[n]++;
                    const entries = Object.entries(counts).filter(([k, v]) => v > 0).sort((a, b) => b[1] - a[1]);
                    if (entries.length >= 2 && entries[0][1] !== entries[1][1]) {
                        const winner = rpsWinner(entries[0][0], entries[1][0]);
                        const loser = winner === entries[0][0] ? entries[1][0] : entries[0][0];
                        for (let dx = -1; dx <= 1; dx++) {
                            for (let dy = -1; dy <= 1; dy++) {
                                const nx = x + dx, ny = y + dy;
                                if (nx >= 0 && ny >= 0 && nx < width && ny < height && grid[ny][nx] === loser) {
                                    newGrid[ny][nx] = winner;
                                }
                            }
                        }
                    }
                }
            }

            // Phase 2: GoL
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const state = newGrid[y][x];
                    const neighbors = getNeighbors(x, y);
                    const alive = neighbors.filter(n => n !== 0).length;
                    if (state && (alive < 2 || alive > 3)) newGrid[y][x] = 0;
                    else if (!state && alive === 3) {
                        const types = { rock: 0, paper: 0, scissors: 0 };
                        for (const n of neighbors) if (n) types[n]++;
                        const entries = Object.entries(types).filter(([_, v]) => v > 0).sort((a, b) => b[1] - a[1]);
                        newGrid[y][x] = entries.length > 1 && entries[0][1] === entries[1][1] ? entries[Math.floor(Math.random() * 2)][0] : entries[0][0];
                    }
                }
            }

            grid = newGrid;
            drawGrid();
        }

        document.getElementById('startBtn').onclick = () => {
            if (!running) {
                running = true;
                const speed = +document.getElementById('speed').value;
                interval = setInterval(step, speed);
            }
        };

        document.getElementById('stopBtn').onclick = () => {
            running = false;
            clearInterval(interval);
        };

        document.getElementById('resetBtn').onclick = () => {
            running = false;
            clearInterval(interval);
            createGrid();
        };

        document.getElementById('randomizeBtn').onclick = () => {
            const options = ['rock', 'paper', 'scissors', 0];
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    grid[y][x] = options[Math.floor(Math.random() * options.length)];
                }
            }
            drawGrid();
        };

        createGrid();
    </script>
</body>

</html>